<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wallet Token Übersicht</title>
<style>
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
  th { background-color: #f2f2f2; }
  .hidden { display: none; }
</style>
</head>
<body>

<h2>Wallet Token Übersicht</h2>

<label>
  <input type="checkbox" id="filterSpam"> Spam-Token ausblenden
</label>

<table id="tokenTable">
  <thead>
    <tr>
      <th>Wallet</th>
      <th>Chain</th>
      <th>Token Adresse</th>
      <th>Name</th>
      <th>Anzahl</th>
      <th>Kurs (USD)</th>
      <th>Wert (USD)</th>
      <th>Spam-Token</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_BASE = "https://private-seven-henna.vercel.app/api"; // Dein Vercel API
const wallets = [
  "0xC7e112D6Db20A4A9213834B2Cb235c34733e6591",
  "0x59dc6669c1eb40df7b36be58812202a09c4491bf",
  "0x76882e6fc045391ba4f19d8a15ea4d8699ff7382",
  "0xbE44d90daD6308AE0b762908D70260c62410346E"
];

// --- Whitelist / Blacklist Beispiel ---
const spamWhitelist = [
  "0x1234567890abcdef1234567890abcdef12345678", // niemals Spam
  "0xabcdefabcdefabcdefabcdefabcdefabcdefabcd"
];

const spamBlacklist = [
  "0x38b6088849e98115315bad2786f6490474158c33",
  "0xfdaa1b7c115d38dabbb83b8fc4b82a09cce63bc9",
  "0xb22f7282af0f418f13172ff12d2b24655c0d30ac",
  "0x61f11808ac03130d0b32588ab0fb0233e6b36198",
  "0x3905dcadc3ea357dcbfb538d74ed4995b5fbf290",
  "0x15910f2d7d7bf5d80750761ac028e7ce312f9d67",
  "0xe17c57af88d9c75ba43c810dad118c8a3ebc431a",
  "0xfd7445566c958aa40334c0a2c74c220ee50047b5",
  "0xf9f842f855e76b23fc2e48c87348995ca65cfa92",
  "0xf745742f3c8ff7bf7ddb9e9762e877e279ae4944",
  "0xda0da3bcfca4828de59a2b2c162cc708dd1c8ff3",
  "0xd5da8318ce7ca005e8f5285db0e750ca9256586e",
  "0xcd6a51559254030ca30c2fb2cbdf5c492e8caf9c",
  "0xcd6a51559254030ca30c2fb2cbdf5c492e8caf9c",
  "0xab6ea9c404a3ba5a6dafc6c52010001535ca161c",
  "0xa42d43c3ebf9040045479c205dc8c6f5ff710f4b",
  "0xa339891bf661d2e366ef2de37b9e2bac829d723d",
  "0xa18b59607b7286a6533fd8c7e8c9716eac9a5c73",
  "0x996c90884a8ebdb1299ad222e193e2e47a6842aa" // immer Spam
];

// --- Spam-Filter ---
function isSpamToken(token) {
  if (!token) return true;
  if(token.token_address && token.token_address.includes("native")) return false;

  // Whitelist / Blacklist prüfen
  if(spamWhitelist.includes(token.token_address)) return false;
  if(spamBlacklist.includes(token.token_address)) return true;

  const name = (token.name || "").toLowerCase();
  const symbol = (token.symbol || "").toLowerCase();
  const balance = token.balance || "0";

  try { if(BigInt(balance) === 0n) return true; } catch { return true; }

  const spamKeywords = ["airdrop","claim","reward","bonus","visit","http","https",".com",".net","free","gift","promo","scam"];
  for(const word of spamKeywords){ if(name.includes(word) || symbol.includes(word)) return true; }

  if(name.length > 40 || symbol.length > 15) return true;
  if(!name || !symbol) return true;

  return false; // kein Spam
}

// --- Laden der Token ---
async function loadData() {
  const tbody = document.querySelector("#tokenTable tbody");
  tbody.innerHTML = "";

  for(const wallet of wallets){
    try {
      const tokensRes = await fetch(`${API_BASE}/wallet?wallet=${wallet}`);
      const tokens = await tokensRes.json();

      for(const t of tokens){
        const balance = t.balance / Math.pow(10, t.decimals);

        if(balance === 0) continue; // Zeilen mit 0 Balance ausblenden

        const spam = isSpamToken(t) ? "Ja" : "Nein";

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${wallet}</td>
          <td>${t.chain}</td>
          <td>${t.token_address}</td>
          <td>${t.symbol}</td>
          <td>${balance.toFixed(4)}</td>
          <td>-</td>
          <td>-</td>
          <td>${spam}</td>
        `;
        if(spam === "Ja") row.classList.add("spam");
        tbody.appendChild(row);
      }

    } catch(e){
      console.error("Fehler bei Wallet:", wallet, e);
    }
  }
}

// --- Filter Checkbox ---
document.getElementById("filterSpam").addEventListener("change", function() {
  const hideSpam = this.checked;
  document.querySelectorAll("#tokenTable tbody tr").forEach(row => {
    if(hideSpam && row.classList.contains("spam")) {
      row.classList.add("hidden");
    } else {
      row.classList.remove("hidden");
    }
  });
});

loadData();
</script>

</body>
</html>