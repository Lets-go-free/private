<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet Übersicht Multi-Chain + Apertum</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background-color: #f2f2f2; }
tfoot td { font-weight: bold; }
</style>
</head>
<body>

<h1>Wallet Übersicht Multi-Chain + Apertum</h1>

<table id="tokenTable">
<thead>
<tr>
  <th>Wallet</th>
  <th>Chain</th>
  <th>Token Adresse</th>
  <th>Name</th>
  <th>Anzahl</th>
  <th>Kurs (USD)</th>
  <th>Wert (USD)</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
  <td colspan="6" style="text-align:right">Gesamtwert pro Wallet:</td>
  <td id="totalValue">$0.00</td>
</tr>
</tfoot>
</table>

<script>
// === Vercel API Base URL ===
const API_BASE = "private-seven-henna.vercel.app/api"; // <-- HIER deine Vercel URL eintragen

// Wallets
const wallets = [
  "0xC7e112D6Db20A4A9213834B2Cb235c34733e6591",
  "0x59dc6669c1eb40df7b36be58812202a09c4491bf",
  "0x76882e6fc045391ba4f19d8a15ea4d8699ff7382",
  "0xbE44d90daD6308AE0b762908D70260c62410346E"
];

// ChainMap für CoinGecko
const chainMap = {
  eth: "ethereum",
  bsc: "binance-smart-chain",
  polygon: "polygon-pos",
  avalanche: "avalanche",
  arbitrum: "arbitrum-one",
  optimism: "optimistic-ethereum",
  "2786": "apertum"
};

// Funktion: Preise von CoinGecko abrufen
async function getPrices(chain, contracts) {
  if(contracts.length === 0) return {};
  const url = `https://api.coingecko.com/api/v3/simple/token_price/${chain}?contract_addresses=${contracts.join(",")}&vs_currencies=usd`;
  const res = await fetch(url);
  return await res.json();
}

// Hauptfunktion: Daten laden
async function loadData() {
  const tbody = document.querySelector("#tokenTable tbody");
  tbody.innerHTML = "";

  for(const wallet of wallets){
    try {
      const tokensRes = await fetch(`${API_BASE}/wallet?wallet=${wallet}`);
      const tokens = await tokensRes.json();
      let totalWallet = 0;

      // ERC-20 Contracts (ohne Native, ohne Apertum)
      const ercContracts = tokens
        .filter(t => !t.token_address.includes("-native") && t.chain !== "2786")
        .map(t => t.token_address.toLowerCase());

      // Preise abrufen für ERC-20
      const prices = await getPrices("ethereum", ercContracts);

      for(const t of tokens){
        const balance = t.balance / Math.pow(10, t.decimals);
        let price = 0;

        if(t.chain === "2786") {
          // Apertum Preis
          try {
            const aptRes = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=apertum&vs_currencies=usd");
            const aptPrice = await aptRes.json();
            price = aptPrice.apertum?.usd || 0;
          } catch(e){
            price = 0;
          }
        } else if(!t.token_address.includes("-native")) {
          price = prices[t.token_address.toLowerCase()]?.usd || 0;
        }

        const value = balance * price;
        totalWallet += value;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${wallet}</td>
          <td>${t.chain}</td>
          <td>${t.token_address}</td>
          <td>${t.symbol}</td>
          <td>${balance.toFixed(4)}</td>
          <td>$${price.toFixed(4)}</td>
          <td>$${value.toFixed(2)}</td>
        `;
        tbody.appendChild(row);
      }

      // Gesamtwert pro Wallet aktualisieren
      document.getElementById("totalValue").innerText = `$${totalWallet.toFixed(2)}`;

    } catch(err){
      console.error("Fehler bei Wallet:", wallet, err);
    }
  }
}

// Daten beim Laden abrufen
loadData();
</script>

</body>
</html>