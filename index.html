<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wallet Token Übersicht (Spam-Analyse)</title>

<style>
body { font-family: Arial, sans-serif; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; font-size: 14px; }
th { background: #f2f2f2; }
tr.spam { background-color: #ffe6e6; }
</style>
</head>

<body>

<h2>Wallet Token Übersicht – Spam Analyse</h2>
<p>Rot markierte Zeilen = als Spam erkannt</p>

<table id="tokenTable">
<thead>
<tr>
  <th>Wallet</th>
  <th>Chain</th>
  <th>Token-Adresse</th>
  <th>Name</th>
  <th>Anzahl</th>
  <th>Spam-Token</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_BASE = "https://private-seven-henna.vercel.app/api";

const wallets = [
  "0xC7e112D6Db20A4A9213834B2Cb235c34733e6591",
  "0x59dc6669c1eb40df7b36be58812202a09c4491bf",
  "0x76882e6fc045391ba4f19d8a15ea4d8699ff7382",
  "0xbE44d90daD6308AE0b762908D70260c62410346E"
];

// ---- Spam Whitelist / Blacklist ----
const spamWhitelist = [
  // "0xTOKENADDRESS"
];

const spamBlacklist = [
  // "0xTOKENADDRESS"
];

// ---- Spam-Erkennung ----
function isSpamToken(t) {
  if (!t) return true;

  const addr = (t.token_address || "").toLowerCase();
  const name = (t.name || "").toLowerCase();
  const symbol = (t.symbol || "").toLowerCase();

  if (spamWhitelist.includes(addr)) return false;
  if (spamBlacklist.includes(addr)) return true;

  if (!name || !symbol) return true;
  if (name.length > 40 || symbol.length > 15) return true;

  const spamWords = [
    "airdrop","claim","reward","bonus","promo","gift",
    "free","visit","http","https",".com",".net","scam"
  ];

  for (const w of spamWords) {
    if (name.includes(w) || symbol.includes(w)) return true;
  }

  return false;
}

// ---- Daten laden ----
async function loadData() {
  const tbody = document.querySelector("#tokenTable tbody");
  tbody.innerHTML = "";

  for (const wallet of wallets) {
    try {
      const res = await fetch(`${API_BASE}/wallet?wallet=${wallet}`);
      const tokens = await res.json();

      console.log("Wallet:", wallet, tokens);

      for (const t of tokens) {
        const balance = Number(t.balance) / Math.pow(10, t.decimals);
        const spam = isSpamToken(t) ? "Ja" : "Nein";

        console.log(
          "Token:",
          t.symbol,
          "Balance:",
          balance,
          "Spam:",
          spam
        );

        const tr = document.createElement("tr");
        if (spam === "Ja") tr.classList.add("spam");

        tr.innerHTML = `
          <td>${wallet}</td>
          <td>${t.chain}</td>
          <td>${t.token_address}</td>
          <td>${t.symbol || "-"}</td>
          <td>${balance}</td>
          <td>${spam}</td>
        `;

        tbody.appendChild(tr);
      }
    } catch (err) {
      console.error("Fehler bei Wallet", wallet, err);
    }
  }
}

loadData();
</script>

</body>
</html>